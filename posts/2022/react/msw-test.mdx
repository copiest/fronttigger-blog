---
title: MSW로 API 모킹하여 프론트엔드 테스트하기 #required
tags:
  - MSW
  - react
  - react-testing-library
  - moking
  - test
published: true # required
date: '2022. 7. 17' # required
description: '우황청심원' # required
thumbnailImg: '/thumbnail/2022/04/react/react-hook.png' # required
---

import Image from './src/components/image'

## 테스트 코드 도입 썰

프론트엔드는 특성상 사용자와의 직접적인 상호작용을 통해 즉각적인 피드백을 받을 수 있다.

이는 장점이자 단점이 될 수 있는데, 그만큼 사이클을 빠르게 처리해야하는 상황이 굉장히 빈번하게 발생한다. 😅

최근 업무를 처리하다보니 새로운 신규 기능 개발도 물론 있었지만 대부분의 업무는 기존의 코드를 유지보수를 하는 경우가 굉장히 많았다.

예를들면 기존 바텀시트 내에 버튼이 새로 추가된다던지, 무언가의 상태값이 추가가 된다던지, 혹은 결제 프로세스의 변경 등 여러 기능에서 추가적인 요구사항이 쏟아졌다.

이렇게 개발하다 보니 위에서 예시를 들었던 결제와 같은 민감한 도메인, 혹은 API가 변경되어야하는 건들이 종종 발생했다. 😖

그래서 이를 개발하기 위해 건드리다보면 문득 불안해지는 시점이 왔었다.

> 혹시 이 코드 때문에 정상적으로 돌아가지 않으면 어떡하지..?  
> API가 변경되서 어디선가 사이드 이펙트가 터지면 어떡하지..?  
> 이 코드는 히스토리를 모르는데..? 엉엉 ㅠㅠㅠㅠ

위의 예시와 같이 기존에 정상적으로 돌아갔던 기능이 돌아가지 않는 것에 대한 불길한 감정들이 엄습했다.

사실 위에서 작성한 예시 뿐만 아니라 많은 상황에서 이런 생각이 들었다.

그래서 이를 타파하기 위해 과감히 도입하자고 결론내린 것이 바로 이전부터 내려온 해결책이 바로 **테스트**다. (물론 100%를 해결해주진 않는다.)

## MSW 도입 이유

특히 프론트엔드의 테스트는 테스트 코드를 작성하는 것 자체도 어렵지만 여러가지 제약사항이 존재했는데, 그 중에 하나가 바로 \`API\`였다.

테스트 환경의 **데이터** 혹은 개발된 **스키마**가 동일하지 않은 상황이 있었으며, 아직 백엔드 개발이 완성되지 않는 상태거나 완성 되었어도 문제로 인해 다시 개발을 해야하는 경우들이 굉장히 빈번하게 발생했다. 이런 고민들을 덜기 위해 여러가지를 고민하던 와중 알아낸 라이브러리 중 [MSW](https://mswjs.io/)를 알게되었다.

MSW는 한 번의 모킹 처리를 통해 **브라우저**와 **노드** 환경을 대응할 수 있다.

<!-- 이미지 -->

브라우저에서는 \`Service Worker\`를 이용해 서버로 요청하는 request를 가로채 moking한 API를 반환해준다.

노드 환경에서는 \`node-request-interceptor\` 라이브러리를 사용하여 http, https, XMLHttpRequest 모듈을 확장해서 처리합니다.
