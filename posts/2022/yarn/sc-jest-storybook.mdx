---
title: styled-components + jest + storybook 환경 구성하기 (feat. 디자인 시스템) #required
tags:
  - yarn
  - typescript
  - rollup
  - react
  - styled-components
  - jest
  - storybook
  - designsystem
published: true # required
date: '2022. 4. 29' # required
description: '베리베리 스트로베리의 두번째 이야기 ✌️' # required
thumbnailImg: '/thumbnail/2022/04/yarn/yarn-berry.png' # required
---

import Image from './src/components/image'

[이전 글](https://tigger.dev/2022/yarn/berry-ts-rollup-react)에서 yarn berry + typescript + rollup + react를 활용하여 환경구성을 진행했었다.

그 다음 글이 제목과도 같은 추가적인 몇가지에 대한 글로 예고를 했었는데 흐름에 맞게 바로 반강제(?)로 진행하게 되었다.

이전 글의 결론은 React 컴포넌트를 만들어서 외부 프로젝트에서 사용하는 것 까지 진행했었다.

그래서 이번엔 styled-components를 통해 컴포넌트를 꾸미고, jest로 그걸 테스트하고, 스토리북을 통해 문서화까지 진행한 경험을 공유하려한다.

### styled-components setup

styled components를 사용하기 위해서는 먼저 디자인 시스템을 사용할 프로젝트를 위해 peerDependencies를 추가해야한다.

#### peerDependencies 추가

```
yarn add -P styled-components
```

추가가 되었다면 이제 타입스크립트를 대응하기 위해 devDependencies에 의존성을 추가한다.

#### devDependencies 추가

```
yarn add -D @types/styled-components
```

이렇게 되면 개발 준비 자체는 다 끝!

만약 여기서 컴포넌트에 대한 네이밍을 통한 디버깅을 용이하게 할 수 있다

#### babel-plugin-styled-components 의존성 추가

```
yarn add -D babel-plugin-styled-components
```

```
// .babelrc

{
  "plugins": ["babel-plugin-styled-components"]
}
```

자 그러면 디버깅까지 준비가 끝났다.

이제 한 번 간단한 버튼 컴포넌트를 통해 테스트해보자

```
// src/button/index.tsx

import React, { PropsWithChildren } from 'react'

import styled from 'styled-components'

interface ButtonProps {
  color?: string
}

const ButtonComponent = styled.button<ButtonProps>`
  color: ${({ color }) => color || 'black'};
`

function Button({ color, children }: PropsWithChildren<ButtonProps>) {
  return <ButtonComponent color={color}>{children}</ButtonComponent>
}

export default Button
```

버튼 완성!

이걸 이제 프로젝트에서 실행을 시켜보자

```
import { Button } from '@fronttigger/design-system';

function App() {
  return (
    <div className='App'>
      <header className='App-header'>
        <Button color='red'>버튼</Button>
      </header>
    </div>
  );
}

export default App;
```

@@ 스타일드 이미지 @@

완벽하게 의도한대로 동작한다!

이제 styled-components를 통해 컴포넌트를 개발할 수 있다.

### Testing Setup

리액트에서도 여러가지 컴포넌트 테스팅 라이브러리가 있지만 가장 대표적인 [react-testing-library](https://testing-library.com/docs/react-testing-library/intro/)가 있다.

위 라이브러리를 활용하여 리액트 컴포넌트 테스트 환경을 구성해보자

#### 의존성 설치

먼저 위 라이브러리를 사용하기 위해서는 [jest](https://jestjs.io/)가 필요하다.

```
yarn add -D jest babel-jest ts-jest @types/jest identity-obj-proxy
```

위 의존성을 모두 설치했다면 react-testing-library 관련된 의존성을 설치하자

```
yarn add -D @testing-library/dom @testing-library/jest-dom @testing-library/react @testing-library/react-hooks @testing-library/user-event @types/testing-library__jest-dom
```

벌써 엄청난 양의 라이브러리를 추가했지만 아직 멀었다.

그 이유는 테스트는 개발환경에서 작성하는 것이기 때문에 리액트가 개발환경에서 테스트될 수 있도록 babel과 react에 관련된 의존성을 또 추가해줘야한다. 😇

```
yarn add -D @babel/preset-env @babel/preset-react babel-preset-react-app react@17.0.2 react-dom@17.0.2 react-is
```

자 이제 거의 다왔다.

#### babel 설정

방금 설치한 babel을 설정한다.

```
{
  "presets": [
    "@babel/preset-env",
    "@babel/preset-react",
    ["react-app", { "flow": false, "typescript": true }]
  ],
  "plugins": ["babel-plugin-styled-components"]
}
```

#### jest 설정

자 이제 테스트의 대망의 마지막 설정 단계다.

jest를 사용하기 위해서는 두가지 파일이 필요한데 \`jest.config.js\`와 \`jest.setup.js\`다.

#### jest.setup.js

```
import '@testing-library/jest-dom'
```

#### jest.config.js

```
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['./jest.setup.js'],
  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'node'],
  moduleDirectories: ['src'],
  testRegex: '(/__(tests|specs)__/.*|(\\.|/)(test|spec))\\.([tj]sx?)$',
  transform: {
    '^.+\\.jsx?$': 'babel-jest',
    '^.+\\.tsx?$': 'ts-jest',
  },
  moduleNameMapper: {
    '\\.(jpg|ico|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$':
      'identity-obj-proxy',
    '\\.(css|less|scss|sass)$': 'identity-obj-proxy',
  },
  globals: {
    __PATH_PREFIX__: '',
    'ts-jest': {
      diagnostics: false,
      tsconfig: 'tsconfig.jest.json',
      babelConfig: true,
    },
  },
}
```

jest를 활용할 tsconfig를 따로 분리하였다. (tsconfig.json으로 한 번에 처리해도 무방하다.)

이 두가지 파일을 통해 test 명령에 대한 설정값을 제공한다.

#### 테스트

이제 임의의 컴포넌트를 구현하고 test를 진행해보자

```
// src/Accordion/index.spec.tsx

import React, { useState } from 'react'
import { render, screen } from '@testing-library/react'
import { renderHook, act } from '@testing-library/react-hooks'
import userEvent from '@testing-library/user-event'
import '@testing-library/jest-dom'

import Accordion from './index'

describe('Accordion', () => {
  test('제목 prop인 title에 "유의사항"을 입력하면 제목에 "유의사항"이 출력된다.', () => {
    render(<Accordion title="유의사항" />)

    const titleElement = screen.getByText('유의사항')
    expect(titleElement).toHaveTextContent('유의사항')
  })

  test('최초 상태의 아코디언을 클릭하면 입력한 아코디언 상세 내용인 "조심하세요"가 보여진다.', () => {
    render(<Accordion>조심하세요</Accordion>)

    const contentElement = screen.getByRole('button')
    userEvent.click(contentElement)

    const detailElement = screen.getByText('조심하세요')
    expect(detailElement).toHaveTextContent('조심하세요')
  })

  test('아코디언의 이벤트를 외부에서 받아왔을 때 상세 내용인 "조심하세요"가 보여진다.', () => {
    const { result } = renderHook((value) => useState(!!value), {
      initialProps: false,
    })

    const handleIsOpenToggle = () => {
      result.current[1]((state) => !state)
    }

    const { rerender } = render(
      <Accordion isOpen={result.current[0]} onToggle={handleIsOpenToggle}>
        조심하세요
      </Accordion>,
    )

    expect(result.current[0]).toBe(false)

    act(() => {
      handleIsOpenToggle()
    })

    rerender(
      <Accordion isOpen={result.current[0]} onToggle={handleIsOpenToggle}>
        조심하세요
      </Accordion>,
    )

    expect(result.current[0]).toBe(true)

    const detailElement = screen.getByText('조심하세요')
    expect(detailElement).toHaveTextContent('조심하세요')
  })
})
```

이제 테스트를 돌려보자

```
yarn jest
```

@@ 테스트 짤 @@

@@ 편안 짤 @@

드디어 길고 긴 테스트를 위한 여정이 끝났다. (테스트 하기도 전에 지쳐버림.. 😭)

이제 마지막 단계인 **Storybook**을 추가해보자
