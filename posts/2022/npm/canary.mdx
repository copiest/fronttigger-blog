---
title: Github Actions를 이용하여 자동으로 Canary 배포 환경 구축하기 #required
tags:
  - npm
  - monorepo
  - rollup
  - canary
  - ci/cd
  - release
published: true # required
date: '2022. 3. 18' # required
description: '까나리액젓 특유의 짠맛과 단맛 그리고 비린 맛' # required
thumbnailImg: '/thumbnail/2022/03/monorepo/npm-rollup.png' # required
---

최근 업무를 하면서 공통 라이브러리의 필요성을 느끼게 되어 사내 라이브러리를 구성중에 있다.

이전 글에서 작성했듯 npm workspaces와 rollup을 사용하여 구성하였고 npm에 배포까지 완료한 상황이다.

최근 추가적으로 테스트 코드를 도입하여 구현한 코드에 대한 테스트를 하고는 있지만, 생각해보니 정식적으로 배포해서 외부에서 사용해보기 전까지는 100% 보장되지 않겠다고 느꼈다.

그래서 생각해 낸 것이 바로 **테스트 형태**의 배포인데, 요 방식이 바로 일명 `Canary` 배포다.

## Canary Release

Canary 배포의 유래는 광부들이 광산에 들어갈 때 유독가스의 누출 여부를 판단하기 위해 일을 할 때 카나리아라는 새를 함께 동행해 새가 먼저 죽게되면 유독가스가 누출되었다는 판단을 하기 위한 방법에서 유래되었다.

이처럼 먼저 특정 대상에 대해 **배포를 진행**하고 **피드백 후(테스트)** 이상유무를 판별하여 **최종 배포**까지 이르는 하나의 배포 방법이다.

이를 단계별 혹은 점진적 배포라고도 불러오기도 했다.

현재 만들고 있는 공통 라이브러리는 사용자들에게 서비스가 되는 중요한 부분이기도 하면서 개발자들이 사용할 때 개발친화적이기도 해야하기 때문에 현 상황에 적합하다고 판단했다.

그래서 이를 간단하게 스크립트를 만든 후 Github Actions를 통해 특정 기능을 push 하면 Canary 버전이 npm에 배포되어 외부에서 테스트 버전으로 사용될 수 있도록 만들어본 경험을 공유하려 한다.
